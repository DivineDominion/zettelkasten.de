@import "_variables.scss";

@import "_normalize.scss";
@import "_base.scss";
@import "_actions.scss";
@import "_menu.scss";
@import "_newsletter.scss";
@import "_beta.scss";
@import "_book-ad.scss";
@import "_the-archive.scss";
@import "_coaching.scss";

// `.post aside` sets padding; littlefoot v3.x doesn't allow overrides
.post aside.littlefoot-footnote { padding: 0 !important; }

:root {
  --content-width: 60rem;
  // The large block elements on the landing page
  --block-radius: min(4vh, 3vw);
  --block-padding: var(--block-radius);
  --block-spacing: var(--block-radius);
  // Their inner elements and cards
  --block-item-radius: calc(var(--block-radius) - var(--block-padding));
  --block-item-spacing: calc(var(--block-radius) / 2);
}

body.homepage {
  background-color: $color-background-nav-main;

  .header-container {
    box-shadow: rgba(0, 0, 0, 0.2) 0rem 0.2rem 0.5rem;
  }
  .header__title {
    margin-block: 1rem;
  }
  .main-navigation { background: transparent; }

  .content-wrapper {
    max-width: 100%; // reset the ~36rem setting from normal pages
    display: flex;
    justify-content: center;

    font-family: $font-sans;
    font-size: 0.8rem;
    line-height: 1.3rem;
    @media only screen and (min-width: $large-breakpoint) {
      font-size: 1rem;
      line-height: 1.6rem;
    }
  }

  .content-wrapper .main {
    max-width: var(--content-width);
    margin-inline: auto;

    display: grid;
    grid-template-columns: 2fr 2fr;
    // grid-template-rows: 8fr 4fr 16fr;  // for finer tuning
    justify-items: stretch;
    gap: calc(2 * var(--block-radius)) var(--block-radius);
  }

  main section {
    padding: var(--block-padding);
    border-radius: var(--block-radius);

    overflow: hidden;
    background: $color-background;
    grid-column-end: span 1;
    grid-row-end: span 1;

    box-shadow: rgba(0, 0, 0, 0.4) 0rem 0.1rem 0.5rem;
  }

  a { border: 0px none; }
  a {
    text-decoration: underline;
    text-underline-offset: 0.1em;
    &:hover { text-decoration: none; }
  }

  p {
    margin-block: 0 1lh;
    --leading-correction: -0.2em;
    &:first-child { margin-block-start: var(--leading-correction); }
    &:last-child { margin-block-end: var(--leading-correction); }
  }

  .landingpage__problem {
    grid-column-start: 1;
    grid-row-start: 1;
  }
  .landingpage__guide {
    grid-column-start: 2;
    grid-row-start: 1;
  }
  .landingpage__product {
    grid-column-start: 1;
    grid-column-end: span 2;
    grid-row-start: 2;
  }
  .landingpage__blog {
    grid-column-start: 1;
    grid-column-end: span 2;
    grid-row-start: 3;
  }

  .landingpage__problem,
  .landingpage__guide,
  .landingpage__product,
  .landingpage__blog {
    padding: var(--block-padding);
  }
  .landingpage__product {
    // Halve the inner spacing to make the product boxes round
    --block-padding: calc(var(--block-radius) / 2);
    --block-item-radius: calc(var(--block-radius) - var(--block-padding));
  }

  .landingpage__problem {
    display: flex;
    flex-direction: row-reverse;
    flex-wrap: wrap;
    align-content: flex-start; // top
    justify-content: center;
    gap: 1lh;

    h2 {
      flex: 1 1 100%;
      font-size: 1.5rem;
      // font-weight: normal;
      // margin-top: -0.2lh;
      letter-spacing: -1px;
      line-height: 1.6rem;
    }

    h2, p {
      margin-block: 0;
    }

    p, img {
      flex: 1 1 30%;
    }

    img {
      mix-blend-mode: multiply;
      opacity: .4;
      max-width: 80%;
      align-self: center;
      @media only screen and (min-width: $large-breakpoint) {
        max-width: 60%;
        max-height: 60%;
      }
    }

    p {
      // margin-block: 1.6rem 0;
      z-index: 100;

      // font-size: 2.1rem; // fallback
      // font-size: max(1.5rem, min(3.5vw, 5.4vh));
      font-size: 1.2rem;
      letter-spacing: -1px;

      // font-family: $font-serif;
      b {
        font-family: $font-serif;
        font-style: italic;
        font-weight: 900;
        letter-spacing: -1px;
      }
    }
  }

  .landingpage__guide {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    gap: 1lh;

    .intro {
      margin-top: 0.4rem;
      // font-size: 1.2rem;
    }

    .guides {
      display: flex;
      flex-direction: row;
      gap: 1rem;
      // align-content: stretch;
      justify-content: stretch;
      align-items: flex-end;
    }

    .guide {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;

      border: 0; // reset link border

      text-align: center;

      .photo {
        img {
          flex-grow: 1;
          display: block;
          max-width: 100%;
          max-height: 8lh;
          width: 100%;
          height: auto;
          object-fit: cover;
          aspect-ratio: 1 / 1;

          @media only screen and (min-width: $large-breakpoint) {
            aspect-ratio: 5 / 3;
          }
        }
      }
      .more {
        flex-shrink: 0;
        display: block;
        font-size: 0.8rem;
      }
    }
  }

  .landingpage__product {
    position: relative;
    overflow: visible; // don't clip the tag

    display: grid;

    grid-template-columns: 1fr 1fr 1fr;
    justify-items: stretch;
    gap: var(--block-item-spacing);

    .wow {
      --scale-factor: 0.8;
      @media only screen and (min-width: $large-breakpoint) {
        --scale-factor: 1.2;
      }
      @media only screen and (min-width: 1600px) {
        --scale-factor: 1.6;
      }
      grid-column: 1 / span 1;

      font-family: $font-serif;
      font-style: italic;
      font-weight: 900;
      letter-spacing: -1px;
      position: absolute;

      font-size: 1.2rem;
      rotate: -5deg;
      background: $color-background-header;
      border-radius: 2vh;
      padding: 1vh;
      width: 20ch;
      text-align: center;
      line-height: 1em;
      transform: translate(-3vw, -5vh) scale(var(--scale-factor));
      z-index: 1337;
      box-shadow: rgba(0, 0, 0, 0.2) 0.1rem 0.1rem 0.1rem,
                  rgba(0, 0, 0, 0.1) 0.3rem 0.2rem 0.5rem;
    }

    .description {
      grid-column: 1 / span 3;
      margin-block: 0;
      @media only screen and (min-width: $large-breakpoint) {
        grid-column: 2 / span 2;
      }
     }

    .product {
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
      align-items: center;
      padding: 0.5rem;

      border: 0;  // reset link border
      border-radius: var(--block-item-radius);
      background: #d07c84;
      color: white;
      min-height: 3lh;

      transition-property: transform box-shadow;
      transition-duration: 0.1s;

      &:hover {
        transform: scale(1.02) translate(0, -1%);
        box-shadow: rgba(0,0,0,0.1) 0 0.1rem 0.1rem;
      }

      a {
        font-weight: bold;
        color: white;
        //text-decoration: underline; // inherited from default style now
      }
    }
  }

  .posts_list {
    margin: 0;
    padding: 0;

    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(22ch, 100%), 1fr));
    gap: var(--block-item-spacing);

    article {
      // border-radius: 2vh;
      //border: 1px solid lime;
      span { font-family: "PT Mono", $font-mono; }
      h3 {
        font-size: 1rem;
        margin-bottom: 0;
      }
      p, .description {
        font-size: 0.8rem;
        line-height: 1.3rem;
      }
      &:hover {
      }
    }
  }

  // Cover whole card with sole link
  .card { position: relative; }
  .card a { }
  .card a::before {
    content: "";
    position: absolute;
    inset: 0;
  }
}

#footer {
  padding: 4vh;

  .wrapper {
    display: grid;
    //grid-template-columns: repeat(4, 1fr);
    grid-template-columns: [content-start] repeat(auto-fill, minmax(calc(10% + 7.5rem), 1fr)) [content-end]; // Fallback
    grid-template-columns: [content-start] repeat(auto-fill, minmax(min(10rem, 100%), 1fr)) [content-end];
    grid-gap: 2rem;
    justify-items: stretch;
    max-width: var(--content-width);
    margin-inline: auto;

    .search {
      grid-column: content;
    }

    .copyright {
      grid-column: span 2;
    }

    section {
      grid-column: span 1;
      font-size: 0.8rem;
      h3 {
        font-size: 1rem;
        margin-block: 0;
      }
      ul, ol { margin-block: 0; }
    }
  }
}
